<%
  is_first_chapter = @chapter.position <= 1
  story = @chapter.story

  def tag_html(tag_name, tag)
    if tag
      "<dt class=\"col-sm-2\">#{tag_name}:</dt> <dd class=\"col-sm-10\">#{tag}</dd>"
    else
      "<dt class=\"col-sm-2\">No #{tag_name}:</dt> <dd class=\"col-sm-10\">-</dd>"
    end
  end
%>

<% content_for :title, story.title + " - Chapter #{@chapter.position}" %>

<!-- Body Content -->
<h2><%= @chapter.title %></h2>

<dl class="row bg-faded">

    <dt class="col-sm-2">Title:</dt> <dd class="col-sm-10"><%= story.title %></dd>

  <% if is_first_chapter && @config.present? %>
    <dt class="col-sm-2">Note:</dt><br />
    <dd style="border: 1px silver solid;">
      <%= @config.ODNote %>
      <% if story.notes %>
        <br /><br /><span>Author's notes:</span> <%= story.notes %>
      <% end %>
    </dd>
  <% end %>

  <dt class="col-sm-2">Summary:</dt> <dd class="col-sm-10"><%= raw story.summary %></dd>

  <%= raw tag_html("Rating", story.rating) %>
  <%= raw tag_html("Warnings", story.warnings) %>
  <%= raw tag_html("Categories", story.categories) %>
  <%= raw tag_html("Fandoms", story.fandoms) %>
  <%= raw tag_html("Relationships", story.relationships) %>
  <%= raw tag_html("Characters", story.characters) %>
  <%= raw tag_html("Tags", story.tags) %>

  <% if is_first_chapter && story.date.present? %>
    <!--// DON'T INDENT - THIS GETS SCRAPED-->
    <dt class="col-sm-2">Date:</dt> <dd class="col-sm-10"><%= story.date.to_s(:iso_date) %></dd>
  <% end %>
  <% if story.updated.present? %>
    <dt class="col-sm-2">Updated:</dt> <dd class="col-sm-10"><%= story.updated.to_s(:iso_date) %></dd>
  <% end %>

  <dt class="col-sm-2">Chapter Title:</dt> <dd class="col-sm-10"><%= @chapter.title %></dd>

    <dt class="col-sm-2">Chapter Number:</dt> <dd class="col-sm-10"><%= @chapter.position %></dd>

  <% if @chapter.date.present? %>
    <dt class="col-sm-2">Chapter posted</dt> <dd class="col-sm-10"><%= @chapter.date.to_s(:iso_date) %></dd>
  <% end %>
</dl>

<div class="chapter-content" style="white-space: pre-line">
  <% if @chapter.notes.present? %>
    <dt class="col-sm-2">Author's notes:</dt> <dd class="col-sm-10"><%= raw @chapter.notes %></dd>
  <hr />
  <% end %>
  <%= raw @chapter.text %>
</div>
